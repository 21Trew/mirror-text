<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Mirror Text – Mobile Safe</title>

<style>
body {
  margin: 0;
  height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  background: white;
}

canvas {
  width: 800px;
  height: 300px;
}

button {
  position: absolute;
  padding: 14px 20px;
  font-size: 16px;
  z-index: 10;
}
</style>
</head>
<body>

<button id="start">Look in the mirror</button>

<video id="video" muted playsinline style="display:none"></video>
<canvas id="canvas"></canvas>

<script>
const video = document.getElementById("video");
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const startBtn = document.getElementById("start");

/* ───── DPI fix for mobile ───── */
function resizeCanvas() {
  const dpr = window.devicePixelRatio || 1;
  const width = 800;
  const height = 300;

  canvas.style.width = width + "px";
  canvas.style.height = height + "px";
  canvas.width = width * dpr;
  canvas.height = height * dpr;

  ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
}

resizeCanvas();

/* ───── draw loop ───── */
function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  ctx.save();
  ctx.font = "900 160px Arial Black";
  ctx.textAlign = "center";
  ctx.textBaseline = "middle";
  ctx.fillText("MIRROR", 400, 150);

  ctx.globalCompositeOperation = "source-in";

  ctx.save();
  ctx.scale(-1, 1);
  ctx.drawImage(video, -800, 0, 800, 300);
  ctx.restore();

  ctx.restore();
  ctx.globalCompositeOperation = "source-over";

  requestAnimationFrame(draw);
}

/* ───── iOS requires user gesture ───── */
startBtn.addEventListener("click", async () => {
  startBtn.remove();

  const stream = await navigator.mediaDevices.getUserMedia({
    video: {
      facingMode: "user"
    }
  });

  video.srcObject = stream;
  await video.play();

  requestAnimationFrame(draw);
});
</script>

</body>
</html>
